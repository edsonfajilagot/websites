<!DOCTYPE html>
<html>
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends/page/3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 06:12:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <title>
    
        The Flask Mega-Tutorial, Part VIII: Followers, Contacts And Friends - miguelgrinberg.com
    
</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="description" content="miguelgrinberg.com">
	<meta name="copyright" content="Copyright (c) 2012-2015 Miguel Grinberg">
	<meta name="author" content="Miguel Grinberg">
    
    <meta name="keywords" content="python, programming, flask, web, tutorial, database, self referential, relationship">
    

    
    <!-- Bootstrap -->
    <link href="../../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../../../static/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../../../static/colorbox/colorbox.css" rel="stylesheet" type="text/css" />
    <link href="../../../static/style.css" rel="stylesheet" type="text/css" />

    <link rel="shortcut icon" href="../../../static/favicon.ico">
	<link rel="alternate" type="application/rss+xml" href="../../../feed" title="miguelgrinberg.com RSS feed">

  </head>
  <body>
    
    <!-- facebook sdk -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "../../../../connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- google plus sdk -->
    <script type="text/javascript" src="../../../../apis.google.com/js/plusone.js"></script>
    <!-- twitter sdk -->
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="../../../../platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <!-- linkedin sdk -->
    <script src="../../../../platform.linkedin.com/in.js" type="text/javascript"></script>

    
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="http://blog.miguelgrinberg.com/index">Home</a></li>
                        <li><a href="../../about-me.html">About Me</a></li>
                        <li><a href="../../about-this-blog.html">About This Blog</a></li>
                        
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <p class="navbar-text" style="margin-top: 10px; margin-bottom: 0px;">
                                <a type="application/rss+xml" href="../../../feed"><img src="../../../static/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
                                <a href="https://www.facebook.com/miguelgrinbergblog"><img src="../../../static/facebook.png" alt="Facebook" title="Facebook" /></a>
                                <a href="https://plus.google.com/u/0/117786742456929977820"><img src="../../../static/googleplus.png" alt="Google+" title="Google+" /></a>
                                <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
                                <a href="http://github.com/miguelgrinberg"><img src="../../../static/github.png" alt="GitHub" title="GitHub" /></a>
                                <a href="https://twitter.com/#!/miguelgrinberg"><img src="../../../static/twitter.png" alt="Twitter" title="Twitter" /></a>
                            </p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
    </nav>

    
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-md-push-9 sidebar-bg">
                <div id="sidebar">
                    

                    
                    <h1>Flask Web Development</h1>
                    <p>If you want to learn modern web development techniques with Python and Flask, you may find my O'Reilly book useful:</p>
                    <p><center><a href="http://bit.ly/flaskbook"><img style="border: 1px solid black;" src="../../../static/flask-book-cover-tiny.png"></a></center></p>
                    <p>Visit <a href="http://flaskbook.com/">http://flaskbook.com</a> for information about this and other Flask training products I have created!</p>
                    

                    <h1>About Miguel</h1>
                    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
                    <p>Welcome to my blog!</p>
                    <p>I'm a software engineer, photographer and filmmaker in Portland, Oregon, USA.</p>
                    <p>You can also find me on <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a>, <a href="https://plus.google.com/u/0/117786742456929977820">Google+</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://github.com/miguelgrinberg">Github</a> and <a href="https://twitter.com/#!/miguelgrinberg">Twitter</a>.</p>
                    <p>Thank you for visiting!</p>

                    

                    
                    <h1>Categories</h1>
<ul>

	<li>
		<a href="../../../category/Arduino/feed">
			<img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Arduino.html">Arduino</a></span> (7)
	</li>

	<li>
		<a href="../../../category/Authentication/feed">
			<img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Authentication.html">Authentication</a></span> (4)
	</li>

	<li>
		<a href="../../../category/Blog/feed">
			<img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Blog.html">Blog</a></span> (1)
	</li>

	<li>
		<a href="../../../category/C%2b%2b/feed">
			<img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/C%2b%2b.html">C++</a></span> (5)
	</li>

	<li>
		<a href="../../../category/Cloud/feed">
			<img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Cloud.html">Cloud</a></span> (2)
	</li>

	<li>
		<a href="../../../category/Filmmaking/feed">
			<img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Filmmaking.html">Filmmaking</a></span> (6)
	</li>

	<li>
		<a href="../../../category/Flask/feed">
			<img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Flask.html">Flask</a></span> (39)
	</li>

	<li>
		<a href="../../../category/Games/feed">
			<img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Games.html">Games</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Gear/feed">
			<img src="../../../static/rss-small.png" title="Gear RSS Feed" label="Gear RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Gear.html">Gear</a></span> (6)
	</li>

	<li>
		<a href="../../../category/HTML5/feed">
			<img src="../../../static/rss-small.png" title="HTML5 RSS Feed" label="HTML5 RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/HTML5.html">HTML5</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Heroku/feed">
			<img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Heroku.html">Heroku</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Javascript/feed">
			<img src="../../../static/rss-small.png" title="Javascript RSS Feed" label="Javascript RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Javascript.html">Javascript</a></span> (3)
	</li>

	<li>
		<a href="../../../category/Movie%20Reviews/feed">
			<img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Movie%20Reviews.html">Movie Reviews</a></span> (5)
	</li>

	<li>
		<a href="../../../category/Netflix/feed">
			<img src="../../../static/rss-small.png" title="Netflix RSS Feed" label="Netflix RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Netflix.html">Netflix</a></span> (5)
	</li>

	<li>
		<a href="../../../category/Node.js/feed">
			<img src="../../../static/rss-small.png" title="Node.js RSS Feed" label="Node.js RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Node.html">Node.js</a></span> (1)
	</li>

	<li>
		<a href="../../../category/OpenStack/feed">
			<img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/OpenStack.html">OpenStack</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Personal/feed">
			<img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Personal.html">Personal</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Photography/feed">
			<img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Photography.html">Photography</a></span> (6)
	</li>

	<li>
		<a href="../../../category/Product%20Reviews/feed">
			<img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Product%20Reviews.html">Product Reviews</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Programming/feed">
			<img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Programming.html">Programming</a></span> (47)
	</li>

	<li>
		<a href="../../../category/Project%20Management/feed">
			<img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Project%20Management.html">Project Management</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Python/feed">
			<img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Python.html">Python</a></span> (43)
	</li>

	<li>
		<a href="../../../category/REST/feed">
			<img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/REST.html">REST</a></span> (5)
	</li>

	<li>
		<a href="../../../category/Rackspace/feed">
			<img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Rackspace.html">Rackspace</a></span> (1)
	</li>

	<li>
		<a href="../../../category/Raspberry%20Pi/feed">
			<img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Raspberry%20Pi.html">Raspberry Pi</a></span> (6)
	</li>

	<li>
		<a href="../../../category/RhinoSteady/feed">
			<img src="../../../static/rss-small.png" title="RhinoSteady RSS Feed" label="RhinoSteady RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/RhinoSteady.html">RhinoSteady</a></span> (6)
	</li>

	<li>
		<a href="../../../category/Robotics/feed">
			<img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Robotics.html">Robotics</a></span> (6)
	</li>

	<li>
		<a href="../../../category/Video/feed">
			<img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Video.html">Video</a></span> (4)
	</li>

	<li>
		<a href="../../../category/Windows/feed">
			<img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Windows.html">Windows</a></span> (1)
	</li>

</ul>
                    
                </div>
            </div>
            <div class="col-md-8 col-md-pull-4">
                <div id="main">
                    
                    
                    
                    
                    

<div class="post">

<p class="date"><span class="flask-moment" data-timestamp="2012-09-02T01:23:49Z" data-format="format('LL')" data-refresh="0">2012-09-02T01:23:49Z</span></p>
<h1 class="post-title"><a href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends.html">The Flask Mega-Tutorial, Part VIII: Followers, Contacts And Friends</a></h1>
<div class="posted">Posted by <span class="label label-danger"><a href="http://blog.miguelgrinberg.com/author/Miguel Grinberg">Miguel Grinberg</a></span> under <span class="label label-primary"><a href="../../../category/Programming.html">Programming</a></span>, <span class="label label-primary"><a href="../../../category/Python.html">Python</a></span>, <span class="label label-primary"><a href="../../../category/Flask.html">Flask</a></span>. </div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>
<div class="post_body"><p>This is the eighth article in the series in which I document my experience writing web applications in <a href="http://python.org/">Python</a> using the <a href="http://flask.pocoo.org/">Flask</a> microframework.</p>
<p>The goal of the tutorial series is to develop a decently featured microblogging application that demonstrating total lack of originality I have decided to call <code>microblog</code>.</p>
<p><strong>NOTE</strong>: This article was revised in September 2014 to be in sync with current versions of Python and Flask.</p>
<p>Here is an index of all the articles in the series that have been published to date:</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world.html">Part I: Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates.html">Part II: Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms.html">Part III: Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database.html">Part IV: Database</a></li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins.html">Part V: User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars.html">Part VI: Profile Page And Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-unit-testing.html">Part VII: Unit Testing</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends.html">Part VIII: Followers, Contacts And Friends</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination.html">Part IX: Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-full-text-search.html">Part X: Full Text Search</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xi-email-support.html">Part XI: Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-facelift.html">Part XII: Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-dates-and-times.html">Part XIII: Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-i18n-and-l10n.html">Part XIV: I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-ajax.html">Part XV: Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling.html">Part XVI: Debugging, Testing and Profiling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-even-on-the-raspberry-pi.html">Part XVII: Deployment on Linux (even on the Raspberry Pi!)</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-the-heroku-cloud.html">Part XVIII: Deployment on the Heroku Cloud</a></li>
</ul>
<h2>Recap</h2>
<p>Our <code>microblog</code> application has been growing little by little, and by now we have touched on most of the topics that are required to complete the application.</p>
<p>Today we are going to work on our database some more. Each user of our application needs to be able to select which other users he or she wants to follow, so our database must be able to keep track of who is following who. All social applications have this feature in some form. Some call it Contacts, others Connections, Friends, Buddies or Followers. Other sites use this same idea to implement Allowed and Ignored user lists. We will call them Followers, but the implementation is the same regardless of the name.</p>
<h2>Design of the 'Follower' feature</h2>
<p>Before we start coding, let's think about  the functionality that we want to obtain from this feature.</p>
<p>Let's start with the most obvious one. We want our users to easily maintain a list of <em>followed</em> people. </p>
<p>Looking at it from the other side, for each user we want to know the list of its <em>followers</em>.</p>
<p>We also want to have a way to query if a user <em>is following</em> or <em>is followed</em> by another user.</p>
<p>Users will click a "follow" link in the profile page of any other user to begin following that user. Likewise, they'll click a "unfollow" link to stop following a user.</p>
<p>The final requirement is that given a user we can easily query the database to obtain all the posts that belong to the followed users.</p>
<p>So, if you thought this was going to be a quick and easy article, think again!</p>
<h2>Database relationships</h2>
<p>We said we wanted to have all users to have "followed" and "followers" lists. Unfortunately, a relational database does not have a <code>list</code> type, all we have are tables with records and relationships between records.</p>
<p>We already have a table in our database to represent users, so what's left is to come up with the proper relationship type that can model the follower/followed link. This is a good time to review the three database relationship types:</p>
<h3>One-to-many</h3>
<p>We have already seen a one-to-many relationship in the <a href="../../the-flask-mega-tutorial-part-iv-database.html">previous database article</a>. Here is the diagram:</p>
<p><img alt="one-to-many" src="../../../static/images/flask-mega-tutorial-part-iv-2.png" /></p>
<p>The two entities associated with this relationship are <code>users</code> and <code>posts</code>. We say that a user has <em>many</em> posts, and a post has <em>one</em> user. The relationship is represented in the database with the use of a <em>foreign key</em> on the "many" side. In the above example the foreign key is the <code>user_id</code> field added to the <code>posts</code> table. This field links each post to the record of its author in the user table.</p>
<p>It is pretty clear that the <code>user_id</code> field provides direct access to the author of a given post, but what about the reverse? For the relationship to be useful we should be able to get the list of posts written by a given user. Turns out the <code>user_id</code> field in the <code>posts</code> table is enough to answer this question, as databases have indexes that allow for efficient queries such us "retrieve all posts that have a user_id of X".</p>
<h3>Many-to-many</h3>
<p>A many-to-many relationship is a bit more complex. As an example, consider a database that has <code>students</code> and <code>teachers</code>. We can say that a student has <em>many</em> teachers, and a teacher has <em>many</em> students. It's like two overlapped one-to-many relationships from both ends.</p>
<p>For a relationship of this type we should be able to query the database and obtain the list of teachers that teach a student, and the list of students in a teacher's class. Turns out this is pretty tricky to represent, it cannot be done by adding foreign keys to the existing tables.</p>
<p>The representation of a many-to-many relationship requires the use of an auxiliary table called an <em>association table</em>. Here is how the database would look for the students and teachers example:</p>
<p><img alt="many-to-many" src="../../../static/images/flask-mega-tutorial-part-viii-1.png" /></p>
<p>While it may not seem straightforward, the association table with its two foreign keys is able to efficiently answer many types of queries, such as:</p>
<ul>
<li>Who are the teachers of student S?</li>
<li>Who are the students of teacher T?</li>
<li>How many students does teacher T have?</li>
<li>How many teachers does student S have?</li>
<li>Is teacher T teaching student S?</li>
<li>Is student S in teacher T's class?</li>
</ul>
<h3>One-to-one</h3>
<p>A one-to-one relationship is a special case of a one-to-many. The representation is similar, but a constrain is added to the database to prevent the "many" side to have more than one link.</p>
<p>While there are cases in which this type of relationship is useful, it isn't as common as the other two types, since any time one record in a table maps to one record in another table it can be argued that it may make sense for these two tables to be merged into one.</p>
<h2>Representing followers and followed</h2>
<p>From the above relationships we can easily determine that the proper data model is the many-to-many relationship, because a user follows <em>many</em> users, and a user has <em>many</em> followers. But there is a twist. We want to represent users following other users, so we just have users. So what should we use as the second entity of the many-to-many relationship?</p>
<p>Well, the second entity of the relationship is also the users. A relationship in which instances of an entity are linked to other instances of the same entity is called a <em>self-referential relationship</em>, and that is exactly what we need here.</p>
<p>Here is a diagram of our many-to-many relationship:</p>
<p><img alt="many-to-many" src="../../../static/images/flask-mega-tutorial-part-viii-2.png" /></p>
<p>The <code>followers</code> table is our association table. The foreign keys are both pointing to the user table, since we are linking users to users. Each record in this table represents one link between a follower user and a followed user. Like the students and teachers example, a setup like this one allows our database to answer all the questions about followed and followers that we will need. Pretty neat.</p>
<h2>Database model</h2>
<p>The changes to our database model aren't that big. We start by adding the <code>followers</code> table (file <code>app/models.py</code>):</p>
<pre><code>followers = db.Table('followers',
    db.Column('follower_id', db.Integer, db.ForeignKey('user.id')),
    db.Column('followed_id', db.Integer, db.ForeignKey('user.id'))
)
</code></pre>
<p>This is a direct translation of the association table from our diagram. Note that we are not declaring this table as a model like we did for <code>users</code> and <code>posts</code>. Since this is an auxiliary table that has no data other than the foreign keys, we use the lower level APIs in flask-sqlalchemy to create the table without an associated model.</p>
<p>Next we define the many-to-many relationship in the <code>users</code> table (file <code>app/models.py</code>):</p>
<pre><code>class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    nickname = db.Column(db.String(64), index=True, unique=True)
    email = db.Column(db.String(120), index=True, unique=True)
    posts = db.relationship('Post', backref='author', lazy='dynamic')
    about_me = db.Column(db.String(140))
    last_seen = db.Column(db.DateTime)
    followed = db.relationship('User', 
                               secondary=followers, 
                               primaryjoin=(followers.c.follower_id == id), 
                               secondaryjoin=(followers.c.followed_id == id), 
                               backref=db.backref('followers', lazy='dynamic'), 
                               lazy='dynamic')
</code></pre>
<p>The setup of the relationship is non-trivial and requires some explanation. Like we did for the one-to-many relationship in the previous article, we are using the <code>db.relationship</code> function to define the relationship. We will be linking <code>User</code> instances to other <code>User</code> instances, so as a convention let's say that for a pair of linked users in this relationship the left side user is following the right side user. We define the relationship as seen from the left side entity with the name <code>followed</code>, because when we query this relationship from the left side we will get the list of followed users. Let's examine all the arguments to the <code>db.relationship()</code> call one by one:</p>
<ul>
<li><code>'User'</code> is the right side entity that is in this relationship (the left side entity is the parent class). Since we are defining a self-referential relationship we use the same class on both sides.</li>
<li><code>secondary</code> indicates the association table that is used for this relationship.</li>
<li><code>primaryjoin</code> indicates the condition that links the left side entity (the follower user) with the association table. Note that because the <code>followers</code> table is not a model there is a slightly odd syntax required to get to the field name.</li>
<li><code>secondaryjoin</code> indicates the condition that links the right side entity (the followed user) with the association table.</li>
<li><code>backref</code> defines how this relationship will be accessed from the right side entity. We said that for a given user the query named <code>followed</code> returns all the right side users that have the target user on the left side. The back reference will be called <code>followers</code> and will return all the left side users that are linked to the target user in the right side. The additional <code>lazy</code> argument indicates the execution mode for this query. A mode of <code>dynamic</code> sets up the query to not run until specifically requested. This is useful for performance reasons, and also because we will be able to take this query and modify it before it executes. More about this later.</li>
<li><code>lazy</code> is similar to the parameter of the same name in the <code>backref</code>, but this one applies to the regular query instead of the back reference.</li>
</ul>
<p>Don't despair if this is hard to understand. We will see how to use these queries in a moment, and then everything will become clearer.</p>
<p>Since we have made updates to the database, we now have to generate a new migration:</p>
<pre><code>$ ./db_migrate.py
</code></pre>
<p>And with this we have completed the database changes. But we have quite a bit of coding left to do.</p>
<h2>Adding and removing 'follows'</h2>
<p>To promote reusability, we will implement the <code>follow</code> and <code>unfollow</code> functionality in the <code>User</code> model instead of doing it directly in view functions. That way we can use this feature for the actual application (invoking it from the view functions) and also from our unit testing framework. As a matter of principle, it is always best to move the logic of our application away from view functions and into models, because that simplifies the testing. You want to have your view functions be as simple as possible, because those are harder to test in an automated way.</p>
<p>Below is the code to add and remove relationships, defined as methods of the <code>User</code> model (file <code>app/models.py</code>):</p>
<pre><code>class User(db.Model):
    #...
    def follow(self, user):
        if not self.is_following(user):
            self.followed.append(user)
            return self

    def unfollow(self, user):
        if self.is_following(user):
            self.followed.remove(user)
            return self

    def is_following(self, user):
        return self.followed.filter(followers.c.followed_id == user.id).count() &gt; 0
</code></pre>
<p>These methods are amazingly simple, thanks to the power of sqlalchemy who does a lot of work under the covers. We just add or remove items from the <code>followed</code> relationship and sqlalchemy takes care of managing the association table for us.</p>
<p>The <code>follow</code> and <code>unfollow</code> methods are defined so that they return an object when they succeed or <code>None</code> when they fail. When an object is returned, this object has to be added to the database session and committed.</p>
<p>The <code>is_following</code> method does a lot in its single line of code. We are taking the <code>followed</code> relationship query, which returns all the <code>(follower, followed)</code> pairs that have our user as the follower, and we filter it by the followed user. This is possible because the <code>followed</code> relationship has a lazy mode of <code>dynamic</code>, so instead of being the result of the query, this is the actual query object, before execution.</p>
<p>The return from the <code>filter</code> call is the modified query, still without having executed. So we then call <code>count()</code> on this query, and now the query will execute and return the number of records found. If we get one, then we know a link between these two uses is already present. If we get none then we know a link does not exist.</p>
<h2>Testing</h2>
<p>Let's write a test for our unit testing framework that exercises all that we have built so far (file <code>tests.py</code>):</p>
<pre><code>class TestCase(unittest.TestCase):
    #...
    def test_follow(self):
        u1 = User(nickname='john', email='john@example.com')
        u2 = User(nickname='susan', email='susan@example.com')
        db.session.add(u1)
        db.session.add(u2)
        db.session.commit()
        assert u1.unfollow(u2) is None
        u = u1.follow(u2)
        db.session.add(u)
        db.session.commit()
        assert u1.follow(u2) is None
        assert u1.is_following(u2)
        assert u1.followed.count() == 1
        assert u1.followed.first().nickname == 'susan'
        assert u2.followers.count() == 1
        assert u2.followers.first().nickname == 'john'
        u = u1.unfollow(u2)
        assert u is not None
        db.session.add(u)
        db.session.commit()
        assert not u1.is_following(u2)
        assert u1.followed.count() == 0
        assert u2.followers.count() == 0
</code></pre>
<p>After adding this test to the testing framework we can run the entire test suite with the following command:</p>
<pre><code>./tests.py
</code></pre>
<p>And if everything works it should say that all our tests pass.</p>
<h2>Database queries</h2>
<p>Our current database model supports most of the requirements we listed at the start. The one we are missing is, in fact, the hardest. Our index page will show the posts written by all the people that are followed by the logged in user, so we need a query that returns all these posts.</p>
<p>The most obvious solution is to run a query that gives us the list of followed users, which we can already do. Then for each of these returned users we run a query to get the posts. Once we have all the posts we merge them into a single list and sort them by date. Sounds good? Well, not really. </p>
<p>This approach has a couple of problems. What happens if a user is following a thousand people? We need to execute a thousand database queries just to collect all the posts. And now we have the thousand lists in memory that we need to merge and sort. As a secondary problem, consider that our index page will (eventually) have pagination implemented, so we will not display all the available posts but just the first, say, fifty, with links to get the next or previous set of fifty. If we are going to display posts sorted by their date, how can we know which posts are the most recent fifty of all followed users combined, unless we get all the posts and sort them first? This is actually an awful solution that does not scale well.</p>
<p>While this collecting and sorting work needs to be done somehow, us doing it results in a very inefficient process. This kind of work is what relational databases excel at. The database has indexes that allow it to perform the queries and the sorting in a much more efficient way that we can possibly do from our side.</p>
<p>So what we really want is to come up with a single database query that expresses what information we want to get, and then we let the database figure out what is the most efficient way to obtain the data for us.</p>
<p>To end the mystery, here is the query that achieves this. Unfortunately it is yet another heavily loaded one liner that we will add to the <code>User</code> model (file <code>app/models.py</code>):</p>
<pre><code>class User(db.Model):
    #...
    def followed_posts(self):
        return Post.query.join(followers, (followers.c.followed_id == Post.user_id)).filter(followers.c.follower_id == self.id).order_by(Post.timestamp.desc())
</code></pre>
<p>Let's try to decipher this query one piece at a time. There are three parts: the <em>join</em>, the <em>filter</em> and the <em>order_by</em>.</p>
<h3>Joins</h3>
<p>To understand what a join operation does, let's look at an example. Let's assume we have a <code>User</code> table with the following contents:</p>
<table class="data">
<tr><th colspan="2">User</th></tr>
<tr><th>id</th><th>nickname</th></tr>
<tr><td>1</td><td>john</td></tr>
<tr><td>2</td><td>susan</td></tr>
<tr><td>3</td><td>mary</td></tr>
<tr><td>4</td><td>david</td></tr>
</table>

<p>There are some extra fields in the table that are not shown above just to simplify the example.</p>
<p>Let's say that our <code>followers</code> association table says that user "john" is following users "susan" and "david", user "susan" is following "mary" and user "mary" is following "david". The data that represents the above is this:</p>
<table class="data">
<tr><th colspan="2">followers</th></tr>
<tr><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>2</td></tr>
<tr><td>1</td><td>4</td></tr>
<tr><td>2</td><td>3</td></tr>
<tr><td>3</td><td>4</td></tr>
</table>

<p>And finally, our <code>Post</code> table contains one post from each user:</p>
<table class="data">
<tr><th colspan="3">Post</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td></tr>
<tr><td>2</td><td>post from mary</td><td>3</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td></tr>
<tr><td>4</td><td>post from john</td><td>1</td></tr>
</table>

<p>Here again there are some fields that are omitted to keep the example simple.</p>
<p>Below is the join portion of our query, isolated from the rest of the query:</p>
<pre><code>Post.query.join(followers, 
    (followers.c.followed_id == Post.user_id))
</code></pre>
<p>The <code>join</code> operation is called on the <code>Post</code> table. There are two arguments, the first is another table, our <code>followers</code> table. The second argument to the join call is the join <em>condition</em>.</p>
<p>What the join operation will do with all this is create a temporary new table with data from the <code>Post</code> and <code>followers</code> table, merged according to the given condition.</p>
<p>In this example we want the field <code>followed_id</code> of the <code>followers</code> table to match the <code>user_id</code> field of the <code>Post</code> table.</p>
<p>To perform this merge, we take each record from the <code>Post</code> table (the left side of the join) and append the fields from the records in the <code>followers</code> table (the right side of the join) that match the condition. If there is no match, then that post record is removed.</p>
<p>The result of the join in our example results in this temporary table:</p>
<table class="data">
<tr><th colspan="3">Post</th><th colspan="2">followers</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td><td>1</td><td>2</td></tr>
<tr><td>2</td><td>post from mary</td><td>3</td><td>2</td><td>3</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>1</td><td>4</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>3</td><td>4</td></tr>
</table>

<p>Note how the post with user_id=1 was removed from the join, because there is no record in the <code>followers</code> table that has a followed_id=1. Also note how the post with user_id=4 appears twice, because the <code>followers</code> table has two entries with a followed_id=4.</p>
<h3>Filters</h3>
<p>The join operation gave us a list of posts that are followed by someone, without specifying who is the follower. We are only interested in a subset of this list, we need just the posts that are followed by one specific user.</p>
<p>So we will filter this table by the follower user. The filter portion of the query then is:</p>
<pre><code>filter(followers.c.follower_id == self.id)
</code></pre>
<p>Remember that the query is executed in the context of our target user, because it is a method in the User class, so <code>self.id</code> in this context is the id of the user we are interested in. With this filter we are telling the database that we want to keep just the records from the joined table that have our user as a follower. So following our example, if the user we are asking about is the one with id=1, then we would end up with yet another temporary table:</p>
<table class="data">
<tr><th colspan="3">Post</th><th colspan="2">followers</th></tr>
<tr><th>id</th><th>text</th><th>user_id</th><th>follower_id</th><th>followed_id</th></tr>
<tr><td>1</td><td>post from susan</td><td>2</td><td>1</td><td>2</td></tr>
<tr><td>3</td><td>post from david</td><td>4</td><td>1</td><td>4</td></tr>
</table>

<p>And these are exactly the posts that we want!</p>
<p>Remember that the query was issued on the Post class, so even though we ended up with a temporary table that does not match any of our models, the result will be the posts that are included in this temporary table, without the extra columns added by the join operation.</p>
<h3>Sorting</h3>
<p>The final step of the process is to sort the results according to our criteria. The portion of the query that does that says:</p>
<pre><code>order_by(Post.timestamp.desc())
</code></pre>
<p>Here we are saying that the results should be sorted by the timestamp field in descending order, so that the first result will be the most recent post.</p>
<p>There is only one more minor detail that we can add to improve our query. When users  read their followed posts they will probably want to see their own posts inserted in the stream as well, so it would be nice to have those included in the query results.</p>
<p>And turns out there is a very simple way to achieve this that doesn't require any changes! We will just make sure that each user is added as a follower of him/herself in the database, and that will take care of this little problem for us.</p>
<p>To conclude our long discussion on queries, let's write a unit test for our query (file <code>tests.py</code>):</p>
<pre><code>#...
from datetime import datetime, timedelta
from app.models import User, Post
#...
class TestCase(unittest.TestCase):
    #...
    def test_follow_posts(self):
        # make four users
        u1 = User(nickname='john', email='john@example.com')
        u2 = User(nickname='susan', email='susan@example.com')
        u3 = User(nickname='mary', email='mary@example.com')
        u4 = User(nickname='david', email='david@example.com')
        db.session.add(u1)
        db.session.add(u2)
        db.session.add(u3)
        db.session.add(u4)
        # make four posts
        utcnow = datetime.utcnow()
        p1 = Post(body="post from john", author=u1, timestamp=utcnow + timedelta(seconds=1))
        p2 = Post(body="post from susan", author=u2, timestamp=utcnow + timedelta(seconds=2))
        p3 = Post(body="post from mary", author=u3, timestamp=utcnow + timedelta(seconds=3))
        p4 = Post(body="post from david", author=u4, timestamp=utcnow + timedelta(seconds=4))
        db.session.add(p1)
        db.session.add(p2)
        db.session.add(p3)
        db.session.add(p4)
        db.session.commit()
        # setup the followers
        u1.follow(u1)  # john follows himself
        u1.follow(u2)  # john follows susan
        u1.follow(u4)  # john follows david
        u2.follow(u2)  # susan follows herself
        u2.follow(u3)  # susan follows mary
        u3.follow(u3)  # mary follows herself
        u3.follow(u4)  # mary follows david
        u4.follow(u4)  # david follows himself
        db.session.add(u1)
        db.session.add(u2)
        db.session.add(u3)
        db.session.add(u4)
        db.session.commit()
        # check the followed posts of each user
        f1 = u1.followed_posts().all()
        f2 = u2.followed_posts().all()
        f3 = u3.followed_posts().all()
        f4 = u4.followed_posts().all()
        assert len(f1) == 3
        assert len(f2) == 2
        assert len(f3) == 2
        assert len(f4) == 1
        assert f1 == [p4, p2, p1]
        assert f2 == [p3, p2]
        assert f3 == [p4, p3]
        assert f4 == [p4]
</code></pre>
<p>This test has a lot of setup code but the actual test is pretty short. We first check that the number of followed posts returned for each user is the expected one. Then for each user we check that the correct posts were returned and that they came in the correct order (note that we inserted the posts with timestamps that are guaranteed to always order in the same way).</p>
<p>Note the usage of the <code>followed_posts()</code> method. This method returns a query object, not the results. This is similar to how relationships with <code>lazy = 'dynamic'</code> work. It is always a good idea to return query objects instead of results, because that gives the caller the choice of adding more clauses to the query before it is executed.</p>
<p>There are several methods in the query object that trigger the query execution. We've seen that <code>count()</code> runs the query and returns the number of results (throwing the actual results away). We have also used <code>first()</code> to return the first result and throw away the rest, if any. In this test we are using the <code>all()</code> method to get an array with all the results.</p>
<h2>Possible improvements</h2>
<p>We now have implemented all the required features of our 'follower' feature, but there are ways to improve our design and make it more flexible.</p>
<p>All the social networks that we love to hate support similar ways to connect users, but they have more options to control the sharing of information.</p>
<p>For example, we have not elected to support the ability to block users. This would add one more layer of complexity to our queries, since now we not only need to grab the posts of the users we follow, but we need to filter out those from users that decided to block us. How would you implement this? Simple, one more many-to-many self-referential relationship to record who's blocking who, and one more join+filter in the query that returns the followed posts.</p>
<p>Another popular feature in social networks is the ability to group followers into custom lists, and then sharing content only with specific groups. This is also implemented with additional relationships and added complexity to the queries.</p>
<p>We will not have these features in <code>microblog</code>, but if there is enough interest I would be happy to write an article on the topic. Let me know in the comments!</p>
<h2>Tying up loose ends</h2>
<p>We have made an impressive amount of progress today. But while we have solved all the problems related to database setup and querying, we have not enabled the new functionality through our application.</p>
<p>Luckily for us, there aren't any challenges in doing this. We just need to fix view functions and templates to call the new methods in the <code>User</code> model when appropriate. So let's do that before we close this session.</p>
<h3>Being your own follower</h3>
<p>We decided that we were going to mark all users as followers of themselves, so that they can see their own posts in their post stream.</p>
<p>We are going to do that at the point where users are getting their accounts setup, in the <code>after_login</code> handler for OpenID (file 'app/views.py'):</p>
<pre><code>@oid.after_login
def after_login(resp):
    if resp.email is None or resp.email == "":
        flash('Invalid login. Please try again.')
        return redirect(url_for('login'))
    user = User.query.filter_by(email=resp.email).first()
    if user is None:
        nickname = resp.nickname
        if nickname is None or nickname == "":
            nickname = resp.email.split('@')[0]
        nickname = User.make_unique_nickname(nickname)
        user = User(nickname=nickname, email=resp.email)
        db.session.add(user)
        db.session.commit()
        # make the user follow him/herself
        db.session.add(user.follow(user))
        db.session.commit()
    remember_me = False
    if 'remember_me' in session:
        remember_me = session['remember_me']
        session.pop('remember_me', None)
    login_user(user, remember=remember_me)
    return redirect(request.args.get('next') or url_for('index'))
</code></pre>
<h3>Follow and Unfollow links</h3>
<p>Next, we will define view functions that follow and unfollow a user (file <code>app/views.py</code>):</p>
<pre><code>@app.route('/follow/&lt;nickname&gt;')
@login_required
def follow(nickname):
    user = User.query.filter_by(nickname=nickname).first()
    if user is None:
        flash('User %s not found.' % nickname)
        return redirect(url_for('index'))
    if user == g.user:
        flash('You can\'t follow yourself!')
        return redirect(url_for('user', nickname=nickname))
    u = g.user.follow(user)
    if u is None:
        flash('Cannot follow ' + nickname + '.')
        return redirect(url_for('user', nickname=nickname))
    db.session.add(u)
    db.session.commit()
    flash('You are now following ' + nickname + '!')
    return redirect(url_for('user', nickname=nickname))

@app.route('/unfollow/&lt;nickname&gt;')
@login_required
def unfollow(nickname):
    user = User.query.filter_by(nickname=nickname).first()
    if user is None:
        flash('User %s not found.' % nickname)
        return redirect(url_for('index'))
    if user == g.user:
        flash('You can\'t unfollow yourself!')
        return redirect(url_for('user', nickname=nickname))
    u = g.user.unfollow(user)
    if u is None:
        flash('Cannot unfollow ' + nickname + '.')
        return redirect(url_for('user', nickname=nickname))
    db.session.add(u)
    db.session.commit()
    flash('You have stopped following ' + nickname + '.')
    return redirect(url_for('user', nickname=nickname))
</code></pre>
<p>These should be self-explanatory, but note how there is error checking all around, to prevent unexpected problems and try to provide a message to the user and a redirection when a problem has occurred.</p>
<p>Now we have the view functions, so we can hook them up. The links to follow and unfollow a user will appear in the profile page of each user (file <code>app/templates/user.html</code>):</p>
<pre><code>&lt;!-- extend base layout --&gt;
{% extends "base.html" %}

{% block content %}
  &lt;table&gt;
      &lt;tr valign="top"&gt;
          &lt;td&gt;&lt;img src="{{ user.avatar(128) }}"&gt;&lt;/td&gt;
          &lt;td&gt;
              &lt;h1&gt;User: {{ user.nickname }}&lt;/h1&gt;
              {% if user.about_me %}&lt;p&gt;{{ user.about_me }}&lt;/p&gt;{% endif %}
              {% if user.last_seen %}&lt;p&gt;&lt;i&gt;Last seen on: {{ user.last_seen }}&lt;/i&gt;&lt;/p&gt;{% endif %}
              &lt;p&gt;{{ user.followers.count() }} followers | 
              {% if user.id == g.user.id %}
                  &lt;a href="{{ url_for('edit') }}"&gt;Edit your profile&lt;/a&gt;
              {% elif not g.user.is_following(user) %}
                  &lt;a href="{{ url_for('follow', nickname=user.nickname) }}"&gt;Follow&lt;/a&gt;
              {% else %}
                  &lt;a href="{{ url_for('unfollow', nickname=user.nickname) }}"&gt;Unfollow&lt;/a&gt;
              {% endif %}
              &lt;/p&gt;
          &lt;/td&gt;
      &lt;/tr&gt;
  &lt;/table&gt;
  &lt;hr&gt;
  {% for post in posts %}
      {% include 'post.html' %}
  {% endfor %}
{% endblock %}
</code></pre>
<p>In the line we had the "Edit" link we now show the number of followers the user has, followed by one of three possible links:</p>
<ul>
<li>if the user profile belongs to the logged in user, then the "Edit" link shows.</li>
<li>else, if the user is not currently followed a "Follow" link shows.</li>
<li>else, a "Unfollow" link shows.</li>
</ul>
<p>At this point you can run the application, create a few users by logging in with different OpenID accounts and play with following and unfollowing users.</p>
<p>All that is left is to show posts of the followed users in the <code>index</code> page, but we are still missing an important piece of the puzzle before we can do that, so this will have to wait until the next chapter.</p>
<h2>Final words</h2>
<p>We have implemented a core piece of our application today. The topic of database relationships and queries is a pretty complex one, so if there are any questions about the material presented above you are welcome to send your questions in the comments below.</p>
<p>In the next installment we will be looking at the fascinating world of pagination, and we will be finally hooking up posts from the database to our application.</p>
<p>For those of you that are lazy typists (or lazy copy-pasters), below is the updated <code>microblog</code> application:</p>
<p>Download <a href="https://codeload.github.com/miguelgrinberg/microblog/zip/version-0.8">microblog-0.8.zip</a>.</p>
<p>As always, the above zip file does not include a database or the flask virtual environment. Previous articles explain how to regenerate these.</p>
<p>Thanks again for following my tutorial. See you next time!</p>
<p>Miguel</p></div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>


<h4 style="text-align: right"><a name="comments"></a>101 comments</h4>


<div class="comment">
    <ul>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/9c524590a36ccf396e407b41465fdef4ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#51</span> <span class="label label-primary">Jake</span> said
                    <span class="flask-moment" data-timestamp="2014-01-09T00:14:46Z" data-format="fromNow(0)" data-refresh="0">2014-01-09T00:14:46Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Worth noting that followers must be defined earlier in the file than class User or it will complain (although the error message is obvious enough).</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/d559909d42d761eb74febb02d07d047cce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#52</span> <span class="label label-primary">kyc</span> said
                    <span class="flask-moment" data-timestamp="2014-02-05T15:15:08Z" data-format="fromNow(0)" data-refresh="0">2014-02-05T15:15:08Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I have a trouble：
ERROR: test_follow (__main__.TestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &#34;tests.py&#34;, line 46, in test_follow
    assert u1.unfollow(u2) == None
  File &#34;D:\python\microblog2.7\app\models.py&#34;, line 47, in unfollow
    if self.is_following(user):
  File &#34;D:\python\microblog2.7\app\models.py&#34;, line 51, in is_following
    return self.followed.filter(followers.c.followed_id == user.id).count() &gt; 0
AttributeError: &#39;InstrumentedList&#39; object has no attribute &#39;filter&#39;

----------------------------------------------------------------------
Ran 3 tests in 1.931s

FAILED (errors=1)</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/2bc1328c99f04f48f7fb1d5113eb6e3fce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#53</span> <span class="label label-primary">Jack</span> said
                    <span class="flask-moment" data-timestamp="2014-02-06T00:37:06Z" data-format="fromNow(0)" data-refresh="0">2014-02-06T00:37:06Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hey Miquel,

First off, thanks for this tutorial...it&#39;s been an extremely helpful exercise to build a non-trivial site, and I&#39;m looking forward to the release of your book.

I have a question about the way we implemented self-following. Is there a reason we commit twice or is that simply to delineate what was added to the existing code? If so, is it more efficient to only add and commit once? Like: 
    user = User(nickname = nickname, email = resp.email, role = ROLE_USER)
    user.follow(user)
    db.session.add(user)
    db.session.commit()</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#54</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-02-06T02:33:03Z" data-format="fromNow(0)" data-refresh="0">2014-02-06T02:33:03Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@kyc: you are missing the &#34;lazy = dynamic&#34; argument in the configuration of the followers relationship.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#55</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-02-06T02:40:09Z" data-format="fromNow(0)" data-refresh="0">2014-02-06T02:40:09Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Jack: when I wrote this I thought it would be safer to commit first, so that the user would get an id assigned. It turns out this isn&#39;t really necessary, SQLAlchemy (at least the 0.8.x and up) is smart and can write the relationship with the first commit, so I completely agree that this should be written in a single commit.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/39d9456d18579176e13611762fa1f4f2ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#56</span> <span class="label label-primary">Justin Moen</span> said
                    <span class="flask-moment" data-timestamp="2014-02-13T05:44:06Z" data-format="fromNow(0)" data-refresh="0">2014-02-13T05:44:06Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I was having some trouble, so I downloaded your version of the code, but when I run it I get this error message: http://i.imgur.com/UxDtNmx.png. I downloaded flask exactly as specified in the first tutorial. 

Why doesn&#39;t this code work?
I&#39;m positive that I downloaded everything using the exact keystrokes from the first tutorial, so I should have the correct versions of everything -- and everything was working through the first 7 tutorials. 

Any advice?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#57</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-02-13T05:49:43Z" data-format="fromNow(0)" data-refresh="0">2014-02-13T05:49:43Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Justin: your database appears to be bad, it&#39;s missing the user table. Try regenerating it.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/fd6e180e3b8374b75b195ee6b59db1d3ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#58</span> <span class="label label-primary">Vangelis</span> said
                    <span class="flask-moment" data-timestamp="2014-02-28T13:45:30Z" data-format="fromNow(0)" data-refresh="0">2014-02-28T13:45:30Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi, Miguel! Thanks very much for your tutorial. 
I am building a data management system for doctors, patients and their families.
For the reason of privileges, I need declare the table as a model, but I have no idea how to define the attribute &#39;followed&#39; in class User. 
This is my code:
###code
class User(db.Model):
	id = db.Column(db.Integer, primary_key = True)
        #...
	#followed
	followed = db.relationship(&#39;User&#39;, 
		secondary = &#39;Followers&#39;, 
		primaryjoin = (&#39;Followers.follower_id&#39; == id), 
		secondaryjoin = (&#39;Followers.followed_id&#39; == id), 
		backref = db.backref(&#39;followers&#39;, lazy = &#39;dynamic&#39;), 
		lazy = &#39;dynamic&#39;)
class Followers(db.Model):
	id = db.Column(db.Integer, primary_key = True)
	timestamp = db.Column(db.DateTime, primary_key = True)
	follower_id = db.Column(db.Integer, db.ForeignKey(&#39;user.id&#39;))
	followed_id = db.Column(db.Integer, db.ForeignKey(&#39;user.id&#39;))
	follow_privilege = db.Column(db.SmallInteger, default = FOLLOW_PRIVILEGE_ASKING_FOR_READ)
###end code
There&#39;s no error when I migrate the database. However, when I try to login, there is an exception:
AttributeError: type object &#39;Followers&#39; has no attribute &#39;c&#39;
hoping for your help, thanks!
</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#59</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-02-28T15:11:50Z" data-format="fromNow(0)" data-refresh="0">2014-02-28T15:11:50Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Vangelis: making the association table is a bit more complicated than changing the table to a model. See http://docs.sqlalchemy.org/en/rel_0_9/orm/relationships.html#association-object for the details. I have used this pattern in the example application I included in my book, here is the code on GitHub: https://github.com/miguelgrinberg/flasky.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/fd6e180e3b8374b75b195ee6b59db1d3ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#60</span> <span class="label label-primary">Vangelis</span> said
                    <span class="flask-moment" data-timestamp="2014-02-28T16:04:41Z" data-format="fromNow(0)" data-refresh="0">2014-02-28T16:04:41Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Miguel Grinberg: Thank you very much!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/53b1f02549e953097f1518f5e5b265dece2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#61</span> <span class="label label-primary"><a href="tejovanthn.html">Tejovanth N</a></span> said
                    <span class="flask-moment" data-timestamp="2014-04-24T12:14:17Z" data-format="fromNow(0)" data-refresh="0">2014-04-24T12:14:17Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hey,
The test case you&#39;ve written here, test_follow_posts, it fails when  whooshalchemy.whoosh_index(app, Post) is included in the app/models.py file. Is this an issue that was already known?
</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#62</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-04-26T19:52:11Z" data-format="fromNow(0)" data-refresh="0">2014-04-26T19:52:11Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Tejovanth: yes, it is a known problem. You have to use my forked version of Flask-WhooshAlchemy, or wait for the developer of this extension to release the fix that I contributed.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/d4b5f7c8252a0f3fa11e20ae9437b5fcce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#63</span> <span class="label label-primary">SherMM</span> said
                    <span class="flask-moment" data-timestamp="2014-05-02T16:17:49Z" data-format="fromNow(0)" data-refresh="0">2014-05-02T16:17:49Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">When I run the application at this point, I can only see posts relative to the currently logged-in user. So, I can&#39;t follow or unfollow anything. Not sure what the problem is really. I&#39;ve gone over the code a few times, but can&#39;t find my error. </p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#64</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-05-03T01:29:50Z" data-format="fromNow(0)" data-refresh="0">2014-05-03T01:29:50Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@SherMM: Go to the profile page of another user by typing his/her profile URL, then you can start following. The idea is that a user can share the profile URL with others.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/83bd08cf79094444c0ab83da8fbb7f07ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#65</span> <span class="label label-primary">David</span> said
                    <span class="flask-moment" data-timestamp="2014-05-16T12:22:41Z" data-format="fromNow(0)" data-refresh="0">2014-05-16T12:22:41Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi, Thanks for the great tutorial, its been very helpful. One question though. If I wanted to print the names of the followers as well as the count, how would I go about it? Thanks in advance</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#66</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-05-16T14:37:17Z" data-format="fromNow(0)" data-refresh="0">2014-05-16T14:37:17Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@David: this is shown above. The expression that gets you the follower count is user.followers.count().</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/90c41c08e0cbd07e56b1846513af475cce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#67</span> <span class="label label-primary">Alex Leonhardt</span> said
                    <span class="flask-moment" data-timestamp="2014-05-26T10:32:44Z" data-format="fromNow(0)" data-refresh="0">2014-05-26T10:32:44Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel, from a sys admin point of view, having a lot of crazy joins pushed to the DB will later (most likely) prevent or make it very hard to scale the DB load - to use e.g. mysql clusters, one would most likely have to rewrite a significant part of the DB logic to remove joins and do it &#34;a different way&#34; - have you thought of how one would refactor the DB logic w/o pushing it into the code to handle ? Maybe even use a different DB backend like MongoDB / NoSQL ?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#68</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-05-26T16:27:29Z" data-format="fromNow(0)" data-refresh="0">2014-05-26T16:27:29Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Alex: if you have an applications that relies on joins a lot then it is not a good model for a cluster. If you think you will need that level of scalability then you should design your db accordingly, for example by denormalizing to reliy less on joins. In any case, you can encapsulate your database functions in model or service layer classes, so that should you need to redesign you just reimplement the db functions leaving the application code intact.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/90c41c08e0cbd07e56b1846513af475cce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#69</span> <span class="label label-primary">Alex Leonhardt</span> said
                    <span class="flask-moment" data-timestamp="2014-05-26T18:15:33Z" data-format="fromNow(0)" data-refresh="0">2014-05-26T18:15:33Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Miguel - cool thanks, a bit above me coz I&#39;m still learning all this coding stuff, but basically one might even have to go as far as code their own low-level DB functions and model based on those to get the performance required, I guess .. the whole DB modeling is really quite challenging but once gone through, it seems to make more sense :) .. thanks for the awesome blog/tutorial!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/83bd08cf79094444c0ab83da8fbb7f07ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#70</span> <span class="label label-primary">David</span> said
                    <span class="flask-moment" data-timestamp="2014-05-30T13:09:09Z" data-format="fromNow(0)" data-refresh="0">2014-05-30T13:09:09Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thanks for your response. I can do the count of followers. but what i really wanted was the name of each user who is a follower. I tried writing a function for it and calling it in the jinja2 template but it does not work. Here is the function.
def plate():
    friend = User.query.filter_by(name = user_name).first().User


    &lt;p&gt; {% for f in plate %}&lt;/p&gt; {{ f.id }}&lt;p&gt;{% endfor %}</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#71</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-05-30T16:06:08Z" data-format="fromNow(0)" data-refresh="0">2014-05-30T16:06:08Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@David: sorry, missed the first part of your question. To get the followers of a user just do user.followers.all(). This returns a list of all the followers. You can send this list to the template for rendering.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/7ba0d718eb8da149917a9c2cba110717ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#72</span> <span class="label label-primary"><a href="http://nimasoroush.site44.com/">Nima</a></span> said
                    <span class="flask-moment" data-timestamp="2014-09-25T09:41:07Z" data-format="fromNow(0)" data-refresh="0">2014-09-25T09:41:07Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I want to write a self-relational database that support my messaging system using flask and SQLAlchemy. tables are very simple

	class User(Base):
		__tablename__ = &#39;user&#39;
		id = Column(Integer, primary_key=True)
	
and message table is

	class Message (db.Model):
		__tablename__ = &#39;message&#39;

		id = db.Column(db.Integer, primary_key=True)
		emmiter_id = db.Column(db.Integer, db.ForeignKey(&#39;user.id&#39;))
		receiver_id = db.Column(db.Integer, db.ForeignKey(&#39;user.id&#39;))
		text = db.Column(db.Text)
		
can you help me to see how I can manage this self-relational database with extra field? I want to know also how I can manage to add data in this table</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#73</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-09-26T14:19:13Z" data-format="fromNow(0)" data-refresh="0">2014-09-26T14:19:13Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Nima: you many-to-many relationship is a bit more complex than the one I present in this article, because you need to store extra data in the association table. SQLAlchemy supports this with a &#34;association object&#34;  pattern. The followers feature I present in my book uses this solution to store the date a user started following another, that applies to your example as well. The official documentation is here: http://docs.sqlalchemy.org/en/rel_0_9/orm/relationships.html#association-object.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/13ba51326d6730418de1643dacbbf1bdce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#74</span> <span class="label label-primary">Dmitry</span> said
                    <span class="flask-moment" data-timestamp="2014-11-13T07:46:05Z" data-format="fromNow(0)" data-refresh="0">2014-11-13T07:46:05Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">By the may a better place for following one&#39;s self might be in User constructor</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/970476b5ae7d342eb53974b4cf5c8ff8ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#75</span> <span class="label label-primary">Brett Gerry</span> said
                    <span class="flask-moment" data-timestamp="2014-11-17T23:51:48Z" data-format="fromNow(0)" data-refresh="0">2014-11-17T23:51:48Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">One quick typo check: in this app/views.py after_login function, you have the line:
redirect(url_for(&#39;login&#39;))
This should be:
return redirect(url_for(&#39;login&#39;))
Not a big deal as this line is not being edited in this tutorial, but could cause errors for some copy and pasters.</p>
                </div>
            </div>
        </li>
        
    </ul>
</div>

<div class="page">
<ul class="pager">
  <li class="previous">
    <a href="1.html#comments">&laquo;&laquo;</a>
  </li>
  <li class="previous">
    <a href="2.html#comments">&laquo;</a>
  </li>
  <li class="next">
    <a href="0.html#comments">&raquo;&raquo;</a>
  </li>
  <li class="next">
    <a href="4.html#comments">&raquo;</a>
  </li>
</ul>
</div>

<h3><a name="commentform"></a>Leave a Comment</h3>

<form action="#commentform" method="post"
  class="form" role="form">
  <div style="display:none;"><input id="csrf_token" name="csrf_token" type="hidden" value="1439536503.03##5f0ff6fb6b5980473f93bba2ce566ef72f694161"></div>
  
    
    






<div class="form-group "><label class="control-label" for="name">Name</label>
        <input class="form-control" id="name" name="name" required type="text" value="">
  </div>


    




<div class="form-group "><label class="control-label" for="url">URL</label>
        <input class="form-control" id="url" name="url" type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="email">Email</label>
        <input class="form-control" id="email" name="email" required type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="comment">Comment</label>
        <textarea class="form-control" id="comment" name="comment" required></textarea>
  </div>


    




<div class="form-group "><label class="control-label" for="captcha">Captcha</label>
        
<script type="text/javascript">var RecaptchaOptions = {"custom_translations": {"audio_challenge": "Get an audio challenge", "cant_hear_this": "Download sound as MP3", "help_btn": "Help", "image_alt_text": "reCAPTCHA challenge image", "incorrect_try_again": "Incorrect. Try again.", "instructions_audio": "Type what you hear", "instructions_visual": "Type the text", "play_again": "Play sound again", "privacy_and_terms": "Privacy & Terms", "refresh_btn": "Get a new challenge", "visual_challenge": "Get a visual challenge"}, "theme": "white"};</script>
<script type="text/javascript" src="http://www.google.com/recaptcha/api/challenge?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></script>
<noscript>
  <iframe src="http://www.google.com/recaptcha/api/noscript?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S" height="300" width="500" frameborder="0"></iframe><br>
  <textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
  <input type="hidden" name="recaptcha_response_field" value="manual_challenge">
</noscript>

  </div>


    





  


    <input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">
  





</form>


</div>

                </div>
            </div>
        </div>
        <div id="footer">
            <p class="elapsed">This page was generated in None seconds.</p>
            <p>&copy; 2014 by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
        </div>
    </div>


    
    
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../../../cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js"></script>
    <script type="text/javascript" src="../../../static/prettify.js"></script>
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment-with-langs.min.js"></script>
<script>
function flask_moment_render(elem) {
    $(elem).text(eval('moment("' + $(elem).data('timestamp') + '").' + $(elem).data('format') + ';'));
    $(elem).removeClass('flask-moment');
}
function flask_moment_render_all() {
    $('.flask-moment').each(function() {
        flask_moment_render(this);
        if ($(this).data('refresh')) {
            (function(elem, interval) { setInterval(function() { flask_moment_render(elem) }, interval); })(this, $(this).data('refresh'));
        }
    })
}
$(document).ready(function() {
    flask_moment_render_all();
});
</script>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4777284-15']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            $(".gallery").colorbox({rel:".gallery",maxWidth:"95%",maxHeight:"95%",scalePhotos:true});
            // add prettyprint class to all <pre><code></code></pre> blocks
            var prettify = false;
            $("pre code").parent().each(function() {
                $(this).addClass('prettyprint');
                prettify = true;
            });
            prettyPrint();
        });
    </script>


  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-viii-followers-contacts-and-friends/page/3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 06:12:54 GMT -->
</html>
